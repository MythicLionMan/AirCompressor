<!DOCTYPE html>
<html>
    <head><title>Air Compressor</title></head>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/date-fns/1.30.1/date_fns.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/2.0.1/chartjs-plugin-annotation.min.js"></script>
    <script src="utils.js"></script>
    <script>
        let stateMonitor = new StateMonitor();
        let compressorActions = new CompressorActions(stateMonitor);
        let chartMonitor = new ChartMonitor('compressorTimeline');
        stateMonitor.monitor();
        chartMonitor.monitor();        
    </script>
    <style>
    #compressorTimelineContainer {{
        float: right;
        width: 65%;
        aspect-ratio: 3/2;
    }}
    </style>
    <body>
        <h1>Air Compressor</h1>

        <div id="compressorTimelineContainer">
            <canvas id="compressorTimeline"></canvas>
            <div>
                <button onclick="chartMonitor.setChartDurationIndex(0)">Short</button>
                <button onclick="chartMonitor.setChartDurationIndex(1)">Medium</button>
                <button onclick="chartMonitor.setChartDurationIndex(2)">Long</button>
                
                <label for="show_tank_pressure">
                    <input type="checkbox" id="show_tank_pressure" checked onclick="chartMonitor.setSeriesVisibility(this.checked, 0)" />Tank Pressure
                </label>                
                <label for="show_line_pressure">
                    <input type="checkbox" id="show_line_pressure" checked onclick="chartMonitor.setSeriesVisibility(this.checked, 1)" />Line Pressure
                </label>
                <label for="show_duty">
                    <input type="checkbox" id="show_duty" checked onclick="chartMonitor.setSeriesVisibility(this.checked, 2)" />Duty
                </label>
                <label for="show_activity">
                    <input type="checkbox" id="show_activity" checked onclick="chartMonitor.setActivityVisibility(this.checked)" />Activity
                </label>                
                <label for="show_commands">
                    <input type="checkbox" id="show_commands" checked onclick="chartMonitor.setCommandVisibility(this.checked)" />Commands
                </label>                
            </div>
        </div>
        <h2>State</h2>
        <table>
            <tr><td>System Time</td><td id="system_time">{system_time}</td></tr>
            <tr><td>Tank Pressure</td><td id="tank_pressure">{tank_pressure}</td></tr>
            <tr><td>Line Pressure</td><td id="line_pressure">{line_pressure}</td></tr>
            <tr><td>Compressor On</td><td id="compressor_on">{compressor_on}</td></tr>
            <tr><td>Run Request Pending</td><td id="run_request">{run_request}</td></tr>
            <tr><td>Compressor Motor Running</td><td id="compressor_motor_running">{compressor_motor_running}</td></tr>
            <tr><td>Purge Open</td><td id="purge_open">{purge_open}</td></tr>
            <tr><td>Purge Pending</td><td id="purge_pending">{purge_pending}</td></tr>
            <tr><td>Shutdown</td><td id="shutdown">{shutdown}</td></tr>
            <tr><td>Duty Recovery Time</td><td id="duty_recovery_time">{duty_recovery_time}</td></tr>
            <tr><td>Duty 10 Minutes</td><td id="duty_10">{duty_10}</td></tr>
            <tr><td>Duty 60 Minutes</td><td id="duty_60">{duty_60}</td></tr>
        </table>
        <div>
            <button id="on_button" onclick="compressorActions.turnOn()">Turn On</button>
            <button id="off_button" onclick="compressorActions.turnOff()">Turn Off</button>
            <button id="pause_button" onclick="compressorActions.pause()">Pause</button>
            <button id="run_button" onclick="compressorActions.run()">Run</button>
            <button id="purge_button" onclick="compressorActions.purge()">Purge</button>
        </div>
        <h2>Settings <a href="editSettings.html">Edit</a></h2>
        <table>
            <tr><td>Start Pressure</td><td>{start_pressure}</td></tr>
            <tr><td>Stop Pressure</td><td>{stop_pressure}</td></tr>
            <tr><td>Max Duty</td><td>{max_duty}</td></tr>
            <tr><td>Duty Duration</td><td>{duty_duration}</td></tr>
            <tr><td>Recovery Time</td><td>{recovery_time}</td></tr>
            <tr><td>Drain Duration</td><td>{drain_duration}</td></tr>
            <tr><td>Drain Delay</td><td>{drain_delay}</td></tr>
            <tr><td>Compressor On Power Up</td><td>{compressor_on_power_up}</td></tr>
            <tr><td>Auto Stop Time</td><td>{auto_stop_time}</td></tr>
            <tr><td>Log Interval</td><td>{log_interval}</td></tr>
        </table>
    </body>
</html>